# üß† CapTableGuru ‚Äì Data Model

This file outlines the **initial data schema** for CapTableGuru ‚Äî the AI-assisted cap table simulation tool for OpenCapStack. The model is designed to support ownership modeling, funding rounds, SAFE/Note terms, exit scenarios, and user permissions.

---

## üìÅ Entity Overview

| Entity               | Description                                                   |
|----------------------|---------------------------------------------------------------|
| `users`              | All registered users (founders, investors, employees)         |
| `cap_tables`         | Each cap table instance linked to one or more users           |
| `stakeholders`       | Individuals/entities holding equity                           |
| `rounds`             | Investment rounds including equity sales, SAFEs, Notes, etc.  |
| `instruments`        | Financial instruments like SAFEs, Convertible Notes, Equity   |
| `scenarios`          | Dilution/exit simulations and user-created forecasts          |
| `ai_sessions`        | Logs of AI queries and assistant outputs                      |
| `permissions`        | Access control for team sharing or investor view              |

---

## üì¶ Table Definitions

### `users`

| Field            | Type      | Notes                          |
|------------------|-----------|--------------------------------|
| `id`             | UUID      | Primary key                    |
| `name`           | Text      |                                |
| `email`          | Text      | Unique                         |
| `role`           | Enum      | `founder`, `investor`, `team`  |
| `created_at`     | Timestamp |                                |

---

### `cap_tables`

| Field              | Type      | Notes                                 |
|--------------------|-----------|---------------------------------------|
| `id`               | UUID      | Primary key                           |
| `name`             | Text      | Optional project/startup name         |
| `user_id`          | UUID      | Owner (`users.id`)                    |
| `created_at`       | Timestamp |                                       |
| `current_valuation`| Numeric   | Optional current valuation input      |

---

### `stakeholders`

| Field          | Type    | Notes                                |
|----------------|---------|--------------------------------------|
| `id`           | UUID    | Primary key                          |
| `cap_table_id` | UUID    | Foreign key                          |
| `name`         | Text    | Person or entity                     |
| `type`         | Enum    | `founder`, `investor`, `employee`    |
| `shares`       | Numeric | Initial or current shares owned      |
| `instrument_id`| UUID    | FK to instrument (if SAFE/Note)      |

---

### `rounds`

| Field            | Type      | Notes                                 |
|------------------|-----------|---------------------------------------|
| `id`             | UUID      | Primary key                           |
| `cap_table_id`   | UUID      | FK to parent cap table                |
| `name`           | Text      | e.g., Pre-Seed, Seed, Series A        |
| `amount_raised`  | Numeric   | USD                                   |
| `pre_money_valuation` | Numeric | Optional                            |
| `date`           | Date      | Optional for timeline visual          |
| `type`           | Enum      | `equity`, `SAFE`, `convertible_note`  |

---

### `instruments`

| Field              | Type      | Notes                                  |
|--------------------|-----------|----------------------------------------|
| `id`               | UUID      | Primary key                            |
| `round_id`         | UUID      | FK to `rounds`                         |
| `type`             | Enum      | `SAFE`, `convertible_note`, `equity`   |
| `discount`         | Numeric   | SAFE/N Convertible terms               |
| `valuation_cap`    | Numeric   | Optional                               |
| `mfn`              | Boolean   | Most Favored Nation clause             |

---

### `scenarios`

| Field             | Type      | Notes                                |
|-------------------|-----------|--------------------------------------|
| `id`              | UUID      | Primary key                          |
| `cap_table_id`    | UUID      | FK                                   |
| `title`           | Text      | Scenario name (e.g., "Series A Exit")|
| `exit_valuation`  | Numeric   | Modeled exit amount                  |
| `created_by`      | UUID      | User who created it                  |
| `ai_generated`    | Boolean   | True if generated by AI agent        |
| `created_at`      | Timestamp |                                      |

---

### `ai_sessions`

| Field         | Type      | Notes                          |
|---------------|-----------|--------------------------------|
| `id`          | UUID      |                                |
| `user_id`     | UUID      |                                |
| `query`       | Text      | User‚Äôs AI input                |
| `response`    | Text      | Model-generated reply          |
| `timestamp`   | Timestamp |                                |

---

### `permissions`

| Field         | Type      | Notes                          |
|---------------|-----------|--------------------------------|
| `id`          | UUID      |                                |
| `cap_table_id`| UUID      |                                |
| `user_id`     | UUID      | Shared with this user          |
| `role`        | Enum      | `admin`, `editor`, `viewer`    |

---

## üîê Future Enhancements

- Add audit log table (`change_logs`)
- Support ESOP pool rules and vesting schedules
- Plug into Stripe customer IDs for monetization
- Support investor syndicate grouping

---

## üß© Supabase Consideration

- Use **Row-Level Security (RLS)** with `permissions` table
- Store JSONB `meta` fields if user adds custom terms
- Enable **realtime** table sync for multi-user cap table edits

---

Would you like this exported as a `.sql` schema or visualized as an ERD diagram as well?
